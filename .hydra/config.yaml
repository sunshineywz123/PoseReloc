trainer:
  _target_: pytorch_lightning.Trainer
  gpus: 0
  min_epochs: 1
  max_epochs: 10
  gradient_clip_val: 0.5
  num_sanity_val_steps: 3
  progress_bar_refresh_rate: 20
  weights_summary: null
  default_root_dir: lightning_logs/
model:
  _target_: src.models.GATs_LoFTR_lightning_model.PL_GATsLoFTR
  optimizer: adam
  lr: 0.001
  weight_decay: 5.0e-05
  architecture: SimpleDenseNet
  input_size: 784
  lin1_size: 256
  dropout1: 0.3
  lin2_size: 256
  dropout2: 0.25
  lin3_size: 128
  dropout3: 0.2
  output_size: 10
  pretrained_ckpt: /cephfs-mvs/3dv-research/hexingyi/code/PoseReloc/models/checkpoints/train_coarse_thr_0.4_layernorm_n_head_8_finew5_fix_backbone_no_hard_train_7000_3d_use_coarse_nofb_no_fineatt_pe_linear_nogat_loftr_c3f1_warp/epoch=12.ckpt
  loftr:
    loftr_backbone:
      type: ResNetFPN
      resolution:
      - 8
      - 2
      resnetfpn:
        block_type: BasicBlock
        initial_dim: 128
        block_dims:
        - 128
        - 196
        - 256
        output_layers:
        - 3
        - 1
      pretrained: weight/loftr_w9_no_cat_coarse_auc10=0.685.ckpt
      pretrained_fix: false
    interpol_type: bilinear
    keypoints_encoding:
      enable: true
      type: mlp_linear
      descriptor_dim: 256
      keypoints_encoder:
      - 32
      - 64
      - 128
      norm_method: instancenorm
    positional_encoding:
      enable: true
      pos_emb_shape:
      - 256
      - 256
    loftr_coarse:
      type: LoFTR
      d_model: 256
      d_ffm: 128
      nhead: 8
      layer_names:
      - self
      - cross
      layer_iter_n: 3
      dropout: 0.0
      attention: linear
      norm_method: layernorm
      kernel_fn: elu + 1
      d_kernel: 16
      redraw_interval: 2
      rezero: null
      final_proj: false
      d_model_2D: 256
      max_shape_2D:
      - 256
      - 256
      feature_dim_3D: 256
      keypoints_encoder_3D:
      - 32
      - 64
      - 128
      norm_method_3D: instancenorm
      encoding_type_3D: sine
    coarse_matching:
      type: dual-softmax
      thr: 0.1
      feat_norm_method: sqrt_feat_dim
      border_rm: 2
      spg_spvs: false
      skh:
        fp16: false
        iters: 20
        partial_impl: dustbin
        init_bin_score: 1.0
        prototype_impl: learned
        prefilter: true
        with_prior: false
        linear:
          enable: false
          mapping: favor
          mapping_dim: 4096
      dual_softmax:
        temperature: 0.08
      train:
        train_padding: true
        train_coarse_percent: 0.3
        train_pad_num_gt_min: 200
    loftr_fine:
      enable: true
      window_size: 5
      coarse_layer_norm: false
      type: LoFTR
      d_model: 128
      nhead: 8
      layer_names:
      - self
      - cross
      layer_iter_n: 1
      dropout: 0.0
      attention: linear
      norm_method: layernorm
      kernel_fn: elu + 1
      d_kernel: 16
      redraw_interval: 2
      rezero: null
      final_proj: false
    fine_matching:
      enable: true
      type: s2d
      detector: OnGrid
      s2d:
        type: heatmap
  loss:
    spg_spvs: false
    coarse_type: focal
    coarse_weight: 1.0
    fine_type: l2_with_std
    fine_weight: 0.81
    focal_alpha: 0.5
    focal_gamma: 2.0
    pos_weight: 1.0
    neg_weight: 1.0
    fine_smooth_l1_beta: 1.0
    fine_loss_weight: 1.0
    fine_correct_thr: 1.0
  trainer:
    enable_plotting: true
    canonical_bs: 4
    canonical_lr: 0.0005
    scaling: null
    world_size: null
    n_val_pairs_to_plot: 50
    optimizer: adamw
    true_lr: null
    adam_decay: 0.0
    adamw_decay: 0.1
    scheduler: MultiStepLR
    scheduler_invervel: epoch
    mslr_milestones:
    - 5
    - 8
    - 11
    - 18
    mslr_gamma: 0.5
    cosa_tmax: 30
    elr_gamma: 0.999992
  eval_metrics:
    point_cloud_rescale: 1000
    pnp_reprojection_error: 8
    pose_thresholds:
    - 1
    - 3
    - 5
    model_unit: m
    eval_ADD_metric: false
    ADDS: false
    use_pycolmap_ransac: false
  match_type: softmax
datamodule:
  _target_: src.datamodules.GATs_loftr_datamodule.GATsLoFTRDataModule
  data_dir: ${data_dir}
  batch_size: 3
  train_val_test_split:
  - 55000
  - 5000
  - 10000
  num_workers: 4
  pin_memory: true
  anno_dirs: outputs_${model.match_type}/anno
  train_anno_file: ${merge_output_dir}/${task_name}/train.json
  val_anno_file: ${merge_output_dir}/${task_name}/val.json
  train_percent: 1.0
  val_percent: 0.2
  num_leaf: 8
  shape2d: 2000
  shape3d_train: 10000
  shape3d_val: 10000
  load_3d_coarse: true
  pad3D: false
  img_pad: false
  img_resize:
  - 512
  - 512
  df: 8
  coarse_scale: 0.125
  path_prefix_substitute_3D_source: null
  path_prefix_substitute_3D_aim: null
  path_prefix_substitute_2D_source: null
  path_prefix_substitute_2D_aim: null
callbacks:
  model_checkpoint:
    _target_: pytorch_lightning.callbacks.ModelCheckpoint
    monitor: val/acc
    save_top_k: 2
    save_last: true
    mode: max
    dirpath: checkpoints/
    filename: '{epoch:02d}'
  early_stopping:
    _target_: pytorch_lightning.callbacks.EarlyStopping
    monitor: val/acc
    patience: 100
    mode: max
    min_delta: 0.0
work_dir: ${hydra:runtime.cwd}
data_dir: ${data_base_dir}
print_config: true
type: inference
data_base_dir: /cephfs-mvs/3dv-research/hexingyi/nips_data_release/OnePose_LowTexture
sfm_base_dir: /cephfs-mvs/3dv-research/hexingyi/onepose_sfm_old_version_code_feature_warp
match_type: softmax
task_name: release_test_hard_sfm_oldversion_feature_warp
suffix: ''
feature_method: average
verbose: true
use_global_ray: false
use_local_ray: true
ray:
  slurm: false
  n_workers: 1
  n_cpus_per_worker: 5
  n_gpus_per_worker: 1
  local_mode: false
network:
  detection: loftr
  matching: loftr
object_detector_method: GT
top_k_obj: null
num_val_seq: 1
ids:
- '0604'
- '0601'
- '0603'
exception_obj_names:
- null
output:
  txt_dir: /cephfs-mvs/3dv-research/hexingyi/onepose_test/${task_name}
  visual_vis3d: false
  vis_dir: /cephfs-mvs/3dv-research/hexingyi/onepose_test/${task_name}/vis3d
