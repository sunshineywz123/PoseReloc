# @package _global_

type: sfm
work_dir: ${hydra:runtime.cwd}
data_base_dir: "/nas/users/hexingyi/scan_data"
# data_base_dir: '/nas/users/hexingyi/onepose_hard_data'
output_base_dir: "/nas/users/hexingyi/onepose_sfm"
match_type: "softmax"
redo: True
enable_loftr_post_refine: True

overwrite_all: False
overwrite_coarse: False
overwrite_fine: True

use_global_ray: False
use_local_ray: False
debug: True

ray:
  slurm: False
  n_workers: 2
  n_cpus_per_worker: 5
  n_gpus_per_worker: 1
  local_mode: False
dataset:
  max_num_kp3d: 15000 # 20000 original
  max_num_kp2d: 10000

  data_dir: ${data_base_dir}
  top_k_obj: null
  num_seq: null
  ids:
    # Train Set
    # - '0410'
    # - '0413'
    # - '0414'
    # - '0415'
    # - '0416'
    # - '0418'
    # - '0420'
    # - '0421'
    # - '0443'
    # - '0445'
    # - '0448'
    # - '0460' # Problem exists for this data! no box trans, no intrin_ba, don't use!
    # - '0461'
    # - '0462'
    # - '0463'
    # - '0464'
    # - '0465'
    # - '0477'
    # - '0479'
    # - '0484'
    # - '0499'
    # - '0506'
    # - '0507'
    # - '0509'
    # - '0512'
    # - '0513'
    # - '0516'
    # - '0529'
    # - '0530'
    # - '0531'
    # - '0532'
    # - '0533'
    # - '0536'
    # - '0542'
    # - '0545'
    # - '0546'
    # - '0549'
    # - '0556'
    # - '0561'
    # - '0562'
    # - '0563'
    # - '0566'
    # - '0567'
    # - '0569'
    # - '0571'
    # - '0572'
    # - '0573'
    # - '0574'
    # - '0575'

    # # Some hard objects:
    # # These are known good!
    # - '0600'
    # - '0602'
    # - '0606'
    # - '0607'
    # - '0608'
    # - '0610'
    # - '0612'
    # - '0613'
    # - '0614'
    # - '0615'
    # - '0616'
    # - '0617'
    # - '0618'
    # - '0619'
    # - '0620'
    # - '0621'
    # - '0622'
    # - '0623'
    # - '0624'
    # - '0625'
    # - '0711'
    # - '0712'
    # - '0713'
    # - '0714'
    # - '0715'
    # - '0716'
    # - '0717'
    # - '0718'
    # - '0719'
    # - '0720'
    # - '0721'
  exception_obj_names:
    -

  outputs_dir: ${output_base_dir}
  # anno_dir: ${dataset.outputs_dir}/outputs_${match_type}/anno

network:
  detection: loftr
  detection_model_path: weight/superpoint_v1.pth

  matching: loftr
  matching_model_path: weight/superglue_outdoor.pth

# sfm:
#   gen_cov_from: 'pose' # ['pose', 'index'], index for onepose dataset
#   down_ratio: 15 # 5 original
#   gap: 3
#   covis_num: 15 # 8 original
#   track_length: 8

sfm:
  gen_cov_from: 'index' # ['pose', 'index'], index for onepose dataset
  down_ratio: 5 # 5 original
  gap: 3
  covis_num: 10 # 8 original
  track_length: 8

post_optim:
  coarse_colmap_data:
    feature_track_assignment_strategy: 'greedy'
  optimizer:
    residual_mode: "geometry_error"
    optimize_lr:
      depth: 0.03

post_process:
  filter_bbox_before_filter_track_length: True
  skip_bbox_filter: False

verbose: False

# feature:
# method: 'average'
# num_leaf: 6

disable_lightning_logs: True
